<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Getting Started - Diana Book</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="getting_started.html" class="active"><strong aria-hidden="true">2.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="writing_schemas.html"><strong aria-hidden="true">3.</strong> Writing Schemas</a></li><li class="chapter-item expanded "><a href="config.html"><strong aria-hidden="true">4.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="auth.html"><strong aria-hidden="true">5.</strong> Authentication</a></li><li class="chapter-item expanded "><a href="serverless.html"><strong aria-hidden="true">6.</strong> Going Serverless</a></li><li class="chapter-item expanded "><a href="core/getting_started.html"><strong aria-hidden="true">7.</strong> Core Library</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="core/queries_mutations.html"><strong aria-hidden="true">7.1.</strong> Handling Queries and Mutations</a></li><li class="chapter-item expanded "><a href="core/auth.html"><strong aria-hidden="true">7.2.</strong> Authentication</a></li></ol></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Diana Book</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h1>
<p>Diana is a high-level wrapper around <a href="https://crates.io/crates/async-graphql">async_graphql</a>, and is designed to be as easy as possible to get started with! This page is a basic tutorial of how to get started with a full and working setup.</p>
<h2 id="installation"><a class="header" href="#installation">Installation</a></h2>
<p>Assuming you have Rust already installed (if not, <a href="https://www.rust-lang.org/tools/install">here's</a> a guide on how to do so), you can add Diana as a dependency to your project easily by adding the following to your project's <code>Cargo.toml</code> under <code>[dependencies]</code>:</p>
<pre><code>diana = &quot;0.2.5&quot;
async-graphql = &quot;2.8.2&quot;
</code></pre>
<p>We also install <code>async_graphql</code> directly to prevent errors with asynchronous usage. Now run <code>cargo build</code> to download all dependencies. Diana is large and complex, so this will take quite a while!</p>
<p>If you're new to GraphQL, we highly recommend reading more about it before diving further into Diana. You can see more about it on the <a href="https://graphql.org">official GraphQL website</a>.</p>
<h2 id="project-structure"><a class="header" href="#project-structure">Project Structure</a></h2>
<p>We recommend a specific project structure for new projects using Diana, but it's entirely optional! It is however designed to minimize code duplication and maximize efficiency by allowing you to run both the queries/mutations system and the subscriptions server simultaneously.</p>
<p>Critically, we recommend having three binary crates for your two servers and the serverless function, as well as a library crate for your schemas and configurations. These should all be Cargo workspaces.</p>
<pre><code>lib/
	src/
		lib.rs
	Cargo.toml
server/
	src/
		main.rs
	Cargo.toml
serverless/
	src/
		main.rs
	Cargo.toml
subscriptions/
	src/
		main.rs
	Cargo.toml
Cargo.lock
Cargo.toml
</code></pre>
<p>Set this up for now if possible, and we'll add to it later across the book (it will be assumed that you're using this or something similar).</p>
<p>You should also have the following in your root <code>Cargo.toml</code> to set up workspaces (which you can read more about <a href="https://doc.rust-lang.org/book/ch14-03-cargo-workspaces.html">here</a>):</p>
<pre><code class="language-toml">[workspace]

members = [
	&quot;lib&quot;,
    &quot;server&quot;,
    &quot;serverless&quot;,
	&quot;subscriptions&quot;
]
</code></pre>
<p>Then you can make all the binary crates (everything except <code>lib</code>) dependent on your shared logic by adding this to the <code>Cargo.toml</code> files in <code>server</code>, <code>serverless</code>, and <code>subscriptions</code> under <code>[dependencies]</code>:</p>
<pre><code class="language-toml">lib = { path = &quot;../lib&quot; }
</code></pre>
<p>You can then reference <code>lib</code> in those crates as if it were just another external module!</p>
<h2 id="your-first-schema"><a class="header" href="#your-first-schema">Your first schema</a></h2>
<p>If you're familiar with GraphQL, then the first thing you'll need to do to set up Diana is to write a basic schema. Diana depends entirely on <a href="https://crates.io/crates/async-graphql">async_graphql</a> for this, so <a href="https://async-graphql.github.io">their documentation</a> may also help you (particularly in more advanced cases), though this book should be enough for the simple stuff.</p>
<p>Your first schema can be really simple, we'll just make a simple query that reports the API version when queried (we won't add any mutations or subscriptions for now). Try adding this somewhere in your shared logic:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use diana::{
	async_graphql::{
		Object as GQLObject
	}
}

#[derive(Default, Clone)]
pub struct Query {}
#[GQLObject]
impl Query {
    async fn api_version(&amp;self) -&gt; &amp;str {
        &quot;0.1.0&quot;
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>This is probably the simplest schema you'll ever create! Crucially though, you MUST derive the <code>Default</code> and <code>Clone</code> traits on it. The former is required by <code>async_graphql</code>, and the latter for Diana.</p>
<p>Hopefully you can see that our <code>Query</code> object is simply defining one query, <code>api_version</code>, which just returns <code>0.1.0</code>, the version of our API! Conveniently, <code>async_graphql</code> automatically parses this into the more conventional <code>apiVersion</code> when we call this, so you can conform to Rust and GraphQL conventions at the same time!</p>
<h2 id="your-first-options"><a class="header" href="#your-first-options">Your first options</a></h2>
<p>Every part of Diana is configured using the <code>Options</code> struct, which can be created with <code>Options::builder()</code>. For now, we'll set up a simple configuration without any subscriptions support. Add this to your shared logic:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use diana::{Options, AuthBlockState};
use diana::async_graphql::{EmptyMutation, EmptySubscription};
use crate::Query; // Or wherever you put your `Query` object from the previous section

#[derive(Clone)]
pub struct Context(String);

pub fn get_opts() -&gt; Options&lt;Context, Query, EmptyMutation, EmptySubscription&gt; {
    Options::builder()
        .ctx(Context(&quot;test&quot;.to_string()))
        .auth_block_state(AuthBlockLevel::AllowAll)
        .jwt_secret(&quot;this is a secret&quot;)
        .schema(Query {}, Mutation {}, Subscription {})
        .finish()
        .expect(&quot;Failed to build options!&quot;)
}
<span class="boring">}
</span></code></pre></pre>
<p>Notice that we define a <code>Context</code> struct here. This will get passed around to every GraphQL resolver and you'll always be able to access it. As long as it's <code>Clone</code>able, you can put anything in here safely. A common use-case of this in reality would be as a database connection pool. Here, we just define it with a random string inside.</p>
<p>Next, we define a function <code>get_opts()</code> that initializes our <code>Options</code>. We set the context, define our schema, and do two other things that need some explaining. The first is <code>.auth_block_state()</code>, which sets the required authentication level to access our GraphQL endpoint. Diana has authentication built-in, so this is fundamental. Here, we allow anything, authenticated or not, for educational purposes. In a production app, set this to block everything! You can read more about authentication <a href="./auth.html">here</a>. The second thing that needs explaining is <code>.jwt_secret()</code>. Diana's authentication systems is based on JWTs, which are basically tokens that clients send to servers to prove their identity (the server signed them earlier, and so can verify them). JWTs need a secret to be based on, and we define a very silly one here. In a production app, you should read this from an environment variable and it should be randomly generated (more on that <a href="./auth.html">here</a>).</p>
<h2 id="your-first-server"><a class="header" href="#your-first-server">Your first server</a></h2>
<p>Let's try plugging this into a basic Diana server! Diana is based around integrations for different platforms, and it currently supports only Actix Web for serverful systems, so that's what we'll use! You should add this to your <code>Cargo.toml</code> in the <code>server</code> crate under <code>[dependencies]</code>:</p>
<pre><code class="language-toml">diana-actix-web = &quot;0.2.5&quot;
</code></pre>
<p>Now add the following to your <code>main.rs</code> in the <code>server</code> crate:</p>
<pre><pre class="playground"><code class="language-rust">use diana_actix_web::{
    actix_web::{App, HttpServer},
    create_graphql_server,
};
use diana::async_graphql::{EmptyMutation, EmptySubscription};
use lib::{get_opts, Query}

#[diana_actix_web::actix_web::main]
async fn main() -&gt; std::io::Result&lt;()&gt; {
    let configurer = create_graphql_server(get_opts()).expect(&quot;Failed to set up configurer!&quot;);

    HttpServer::new(move || App::new().configure(configurer.clone()))
        .bind(&quot;0.0.0.0:9000&quot;)?
        .run()
        .await
}
</code></pre></pre>
<p>Firstly, we're pulling in the dependencies we need, including the schema and the function to get our <code>Options</code>. Then, we define an asynchronous <code>main</code> function marked as the entrypoint for <code>actix_web</code>, in which we set up our entire GraphQL server using <code>create_graphql-server()</code>, parsing in our <code>Options</code>. After that, we start up a new Actix Web server, using <code>.configure()</code> to configure the entire thing. Pretty convenient, huh?</p>
<p>If you also have some REST endpoints or the like, you can easily add them to this server as well, <code>.configure()</code> is inbuilt into Actix Web to enable this kind of modularization.</p>
<h2 id="firing-it-up"><a class="header" href="#firing-it-up">Firing it up</a></h2>
<p>The last step of all this is to actually run your server! Go into the <code>server</code> crate and run <code>cargo run</code> to see it in action! If all has gone well, you should see be able to see the GraphiQL playground (GUI for GraphQL development) in your browser at <a href="http://localhost:9000/graphiql">http://localhost:9000/graphiql</a>! Try typing in the following and then run it!</p>
<pre><code>query {
	apiVersion
}
</code></pre>
<p>You should see <code>0.1.0</code> faithfully printed on the right-hand side of the screen.</p>
<p>Congratulations! You've just set up your first GraphQL server with Diana! The rest of this book will help you to understand how to extend this setup to include mutations, subscriptions, and authentication, as well as helping you to deploy it all serverlessly!</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="intro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="writing_schemas.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="intro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="writing_schemas.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
